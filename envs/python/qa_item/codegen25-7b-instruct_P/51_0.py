f
r
o
m
 
t
y
p
i
n
g
 
i
m
p
o
r
t
 
L
i
s
t


i
m
p
o
r
t
 
n
u
m
p
y
 
a
s
 
n
p






d
e
f
 
t
r
a
n
s
f
o
r
m
_
p
o
i
n
t
_
c
l
o
u
d
_
t
o
_
r
e
f
e
r
e
n
c
e
_
f
r
a
m
e
(
p
o
i
n
t
_
c
l
o
u
d
:
 
n
p
.
a
r
r
a
y
,
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
:
 
L
i
s
t
[
n
p
.
a
r
r
a
y
]
)
 
-
>
 
n
p
.
a
r
r
a
y
:


 
 
 
 
"
"
"


 
 
 
 
T
r
a
n
s
f
o
r
m
s
 
a
 
p
o
i
n
t
 
c
l
o
u
d
 
t
o
 
a
 
n
e
w
 
r
e
f
e
r
e
n
c
e
 
f
r
a
m
e
 
d
e
f
i
n
e
d
 
b
y
 
t
h
r
e
e
 
p
o
i
n
t
s
.




 
 
 
 
P
a
r
a
m
e
t
e
r
s
:


 
 
 
 
 
 
 
 
p
o
i
n
t
_
c
l
o
u
d
 
(
n
p
.
a
r
r
a
y
)
:
 
T
h
e
 
N
x
3
 
a
r
r
a
y
 
o
f
 
p
o
i
n
t
s
 
i
n
 
t
h
e
 
o
r
i
g
i
n
a
l
 
r
e
f
e
r
e
n
c
e
 
f
r
a
m
e
.


 
 
 
 
 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
(
L
i
s
t
)
:
 
A
 
l
i
s
t
 
o
f
 
t
h
r
e
e
 
p
o
i
n
t
s
 
(
n
p
.
a
r
r
a
y
)
,
 
d
e
f
i
n
i
n
g
 
t
h
e
 
n
e
w
 
r
e
f
e
r
e
n
c
e
 
f
r
a
m
e
.




 
 
 
 
R
e
t
u
r
n
s
:


 
 
 
 
 
 
 
 
n
p
.
a
r
r
a
y
:
 
T
r
a
n
s
f
o
r
m
e
d
 
p
o
i
n
t
 
c
l
o
u
d
 
i
n
 
t
h
e
 
n
e
w
 
r
e
f
e
r
e
n
c
e
 
f
r
a
m
e
.


 
 
 
 
"
"
"


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
n
p
.
a
r
r
a
y
(
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
)


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
[
:
,
 
:
3
]


 
 
 
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
 
=
 
r
e
f
_
f
r
a
m
e
_
p
o
i
n
t
s
.
T




 
 
 
 
r
e
f
import unittest
import numpy as np

class TestChangeReferenceFrame(unittest.TestCase):
    def setUp(self):
        # Basic setup for tests, initialize some common point clouds and frames
        self.point_cloud = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])
        self.ref_frame_points = [np.array([0, 0, 0]), np.array([1, 0, 0]), np.array([0, 1, 0])]

    def test_identity_transformation(self):
        # Test with an identity transformation where the reference frame is the standard basis
        result = transform_point_cloud_to_reference_frame(self.point_cloud, self.ref_frame_points)
        np.testing.assert_array_almost_equal(result, self.point_cloud - np.array([0, 0, 0]))

    def test_translation(self):
        # Only translation no rotation; move the origin
        frame_points = [np.array([1, 1, 1]), np.array([2, 1, 1]), np.array([1, 2, 1])]
        result = transform_point_cloud_to_reference_frame(self.point_cloud, frame_points)
        expected = np.array([[-1. , 0.,  1.], [ 2. , 3.,  4.], [ 5.,  6. , 7.]])
        np.testing.assert_array_almost_equal(result, expected)

    def test_rotation(self):
        # Rotation about z-axis by 90 degrees
        frame_points = [np.array([0, 0, 0]), np.array([0, 1, 0]), np.array([0, 1, 1])]
        result = transform_point_cloud_to_reference_frame(self.point_cloud, frame_points)
        expected = np.array([[2. , 3.,  1.], [ 5. , 6.,  4.], [ 8.,  9. , 7.]])
        np.testing.assert_array_almost_equal(result, expected)

    def test_non_orthonormal_frame(self):
        # Use non-orthonormal frame to see how function handles it (should normalize internally)
        frame_points = [np.array([0, 0, 0]), np.array([1, 0, 0]), np.array([1, 1, 0])]
        result = transform_point_cloud_to_reference_frame(self.point_cloud, frame_points)
        # Manually compute expected model_answer_result
        u = np.array([1, 0, 0])
        v = np.array([0, 1, 0])
        w = np.cross(u, v)
        rotation_matrix = np.column_stack((u, v, w))
        expected = np.dot(self.point_cloud, rotation_matrix.T)
        np.testing.assert_array_almost_equal(result, expected)

    def test_inverted_frame(self):
        # Inverting the frame to see if negatives are handled
        frame_points = [np.array([0, 0, 0]), np.array([-1, 0, 0]), np.array([0, -1, 0])]
        result = transform_point_cloud_to_reference_frame(self.point_cloud, frame_points)
        expected = np.dot(self.point_cloud, np.array([[-1, 0, 0], [0, -1, 0], [0, 0, 1]]))
        np.testing.assert_array_almost_equal(result, expected)

if __name__ == '__main__':
    unittest.main()